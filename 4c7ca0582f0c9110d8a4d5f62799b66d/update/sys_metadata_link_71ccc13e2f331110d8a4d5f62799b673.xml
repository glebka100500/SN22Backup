<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>710241413720200003c78c00dfbe5d5d</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.MIDPackageUriFactory&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;Retrieves a set of download URIs for a given MIDPackage.&lt;/description&gt;
        &lt;name&gt;MIDPackageUriFactory&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var MIDPackageUriFactory = Class.create();

MIDPackageUriFactory._BASE_MID_PACKAGE_PATH = '/glide/distribution/builds/package/';
MIDPackageUriFactory._LATEST_DIR = 'latest';
MIDPackageUriFactory._SEPARATOR = '/';

MIDPackageUriFactory.prototype = Object.extendsObject(DistDownloadUriFactory, {
	
  initialize: function(midPackage, requestSource) {
    if (!gs.nil(midPackage))
      this.setPackage(midPackage);
	this.setRequestSourceUrl(requestSource);
	this._release_candidate = gs.getProperty('glide.release_candidate', 'false');
  },

  /**
   * Sets the package that this factory will provide URIs for.
   * Required.
   * @param MIDPackage midPackage
   */
  setPackage: function(midPackage) {
    this._midPackage = midPackage;
  },

  /**
   * Retrieves a list of URIs that a package can be downloaded from by order of preference.
   * Requires that the package has been set.
   */
  getUris: function(maxUris) {
    this._setupUriInfo();
    var uris = this.getDownloadUris();
	return uris; 
  },

  /**
   * @param MIDPackage distPackage
   */
  _getDirectoryPath: function(midPackage) {
    var buildstamp = midPackage.getBuildStamp();
    if (JSUtil.nil(buildstamp))
        return midPackage.getName() + MIDPackageUriFactory._SEPARATOR + MIDPackageUriFactory._LATEST_DIR;
    
    var matches = MIDPackage.BUILDSTAMP_REGEX.exec(buildstamp);
    if (matches === null)
      throw new IllegalArgumentException('Invalid buildstamp `' + buildstamp + '`.');

    var path = midPackage.getName()
    + MIDPackageUriFactory._SEPARATOR + matches[3]
    + MIDPackageUriFactory._SEPARATOR + matches[1]
    + MIDPackageUriFactory._SEPARATOR + matches[2];
    return path;
  },

  /**
   * @throws IllegalArgumentException If not factory state is not valid
   */
  _validate: function() {
    if (this._midPackage === null)
      throw new IllegalArgumentException('Package is required.');
  },

  _setupUriInfo: function() {
	this._validate();
	this._fileName = this._midPackage.getFilename();
	var is_app_signed = this._release_candidate == 'true';
	this._path = MIDPackageUriFactory._BASE_MID_PACKAGE_PATH + (is_app_signed? 'app-signed/' : '') + this._getDirectoryPath(this._midPackage);
  },

  type: 'MIDPackageUriFactory'
});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;roy.laurie&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2012-03-01 21:06:43&lt;/sys_created_on&gt;
        &lt;sys_id&gt;710241413720200003c78c00dfbe5d5d&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;48&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;MIDPackageUriFactory&lt;/sys_name&gt;
        &lt;sys_package display_value="MID Server" source="com.glideapp.agent"&gt;881201476d6620100acb70b3534330fa&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_710241413720200003c78c00dfbe5d5d&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;anindya.paramanik&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2021-06-09 20:41:28&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;2232&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:28:25</sys_created_on>
        <sys_id>71ccc13e2f331110d8a4d5f62799b673</sys_id>
        <sys_name>MIDPackageUriFactory</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_71ccc13e2f331110d8a4d5f62799b673</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
