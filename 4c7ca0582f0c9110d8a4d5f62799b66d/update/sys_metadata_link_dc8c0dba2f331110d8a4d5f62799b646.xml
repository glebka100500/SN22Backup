<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>46c18d3d73370010616ca9843cf6a768</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.MultiSSO_OidcUtil&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;Script Include Util for MultiSSO OIDC&lt;/description&gt;
        &lt;name&gt;MultiSSO_OidcUtil&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var MultiSSO_OidcUtil = Class.create();
MultiSSO_OidcUtil.prototype = {
    initialize: function() {},

    /* 
	   This method will fetch all the Active OIDC IDP records which are configured to show on Login page
	   If MultiSSO is Active MSP (Domain Separation) plugin is not active. 
	   Currently showing the login options with OIDC IDP records only supported for Non MSP instances.
	*/
    getOidcIdpRecords: function() {
        var oidc_records = [];
        var isMspPluginActive = GlidePluginManager.isActive('com.glide.domain.msp_extensions.installer');
        var isMultiSSOActive = GlideProperties.getBoolean('glide.authenticate.multisso.enabled');

        // If MultiSSO is Active and MSP (Domain Separation) Plugin is NOT active then, 
        // Query the Active OIDC IDP Records which are configured to be shown on login Screen. 
        if (isMultiSSOActive &amp;&amp; !isMspPluginActive) {
            var oidc_idp_record = {};

            var gr = new GlideRecord("oidc_identity_provider");
            if (gr.isValid()) {
                gr.addActiveQuery();
                gr.addQuery("show_as_login_option", true);
                gr.query();
                while (gr.next()) {
                    oidc_idp_record = {};
                    oidc_idp_record.sysId = gr.getValue("sys_id");
                    oidc_idp_record.logoUrl = gr.getValue("logo_url");
					if (GlideStringUtil.notNil(oidc_idp_record.logoUrl))
                        oidc_idp_record.isLogoUrlValid = true;
					
                    oidc_idp_record.name = gr.getValue("sso_label");
                    if (GlideStringUtil.nil(oidc_idp_record.name))
                        oidc_idp_record.name = gr.getValue("oidc_name");

                    oidc_records.push(oidc_idp_record);
                }
            }
        }

        return oidc_records;
    },
    type: 'MultiSSO_OidcUtil'
};]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2020-03-27 12:52:24&lt;/sys_created_on&gt;
        &lt;sys_id&gt;46c18d3d73370010616ca9843cf6a768&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;2&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;MultiSSO_OidcUtil&lt;/sys_name&gt;
        &lt;sys_package display_value="Integration - Multiple Provider Single Sign-On (do not activate...use 'Integration - Multiple Provid" source="com.snc.integration.sso.multi"&gt;4762a9692fe21110d8a4d5f62799b613&lt;/sys_package&gt;
        &lt;sys_policy&gt;read&lt;/sys_policy&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_46c18d3d73370010616ca9843cf6a768&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2020-03-27 14:23:56&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;1881&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:27:13</sys_created_on>
        <sys_id>dc8c0dba2f331110d8a4d5f62799b646</sys_id>
        <sys_name>MultiSSO_OidcUtil</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_dc8c0dba2f331110d8a4d5f62799b646</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
