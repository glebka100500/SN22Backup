<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>8f1f170fc0a80027007166438cb41a11</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.CatalogTransactionUpdateCart&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description/&gt;
        &lt;name&gt;CatalogTransactionUpdateCart&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[gs.include('PrototypeServer');
gs.include('AbstractTransaction');

var CatalogTransactionUpdateCart = Class.create();

CatalogTransactionUpdateCart.prototype =  Object.extendsObject(AbstractTransaction, {
	
	execute : function() {
		try {
			var cart_item = this.request.getParameter('sysparm_cart_id');
			var cart;
			var cartName = this.request.getParameter("sysparm_cart_name");
			if(JSUtil.nil(cartName) &amp;&amp; !JSUtil.nil(cart_item)) {
				//Because many times we only send CartItem id but not CartName
				var gr = new GlideRecord('sc_cart_item');
				if (gr.get(cart_item))
					cartName = '' + gr.cart.name;
				else
					cartName = '';
			} 
			if (!JSUtil.nil(cartName))
				cart = GlideappCart.get(cartName);
			else
				cart = GlideappCart.get();
			cart.updateCart(this.request, cart_item);
			//for new order now, an entry was inserted in default cart, on editing the item from order now specific cart, that entry needs to be edited in default cart as well
			var isNewOrderNow = '' + gs.getProperty("glide.sc.enable_order_now", "false");
			if(isNewOrderNow == 'true' &amp;&amp; !JSUtil.nil(cartName) &amp;&amp; cartName.startsWith('cart_')) {
				var itemId = gs.getSession().getProperty('default_cart_item');
				if (!JSUtil.nil(itemId)){
					cart = GlideappCart.get();
					cart.updateCart(this.request,itemId);
				}
			}
			var stack = gs.getSession().getStack();
			if (stack.size() ==1 )
				return stack.pop();

			return stack.back();
		} catch(e) {
			var catalogExceptionUtils = new CatalogExceptionUtils();
			if(catalogExceptionUtils.isCartException(e)) {
				return catalogExceptionUtils.handleCartException(e);	
			}
		}
	}
});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;glide.maint&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2008-09-23 12:11:31&lt;/sys_created_on&gt;
        &lt;sys_id&gt;8f1f170fc0a80027007166438cb41a11&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;17&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;CatalogTransactionUpdateCart&lt;/sys_name&gt;
        &lt;sys_package display_value="Service Catalog Platform" source="com.glideapp.servicecatalog.platform"&gt;6d218d0f6d2620100acb70b35343303c&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_8f1f170fc0a80027007166438cb41a11&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2020-01-09 12:43:12&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;1640&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:29:31</sys_created_on>
        <sys_id>460dc57e2f331110d8a4d5f62799b682</sys_id>
        <sys_name>CatalogTransactionUpdateCart</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_460dc57e2f331110d8a4d5f62799b682</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
