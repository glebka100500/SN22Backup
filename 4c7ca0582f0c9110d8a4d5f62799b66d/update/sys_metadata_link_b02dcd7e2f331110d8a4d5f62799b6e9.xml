<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>979c42d5c32212001c845cb981d3ae0d</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;public&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.MatchingDimensionSkills&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;Dimension to process skills.&lt;/description&gt;
        &lt;name&gt;MatchingDimensionSkills&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var MatchingDimensionSkills = Class.create();
MatchingDimensionSkills.prototype = Object.extendsObject(AbstractMatchingDimension, {
	
	process : function(task, users, taskFieldValues, args){
		var skillsRequired = [];
		var selectedSkills = taskFieldValues;
		if(selectedSkills &amp;&amp; selectedSkills.length &gt; 0){
			skillsRequired = selectedSkills;
		}
		
		/*var taskSkillRecord = new GlideRecord('task_m2m_skill');
		taskSkillRecord.addQuery('mandatory', false);
		taskSkillRecord.addQuery('task', task.sys_id);
		taskSkillRecord.query();
		while(taskSkillRecord.next()){
			if(skillsRequired.indexOf(taskSkillRecord.skill) &lt; 0){
				skillsRequired.push(taskSkillRecord.skill);
			}
		}*/
		
		var returnUsers = {};
		if(skillsRequired.length == 0)
		{
			for(var i=0;i&lt;users.length;i++){
				var ratingObj = {};
				ratingObj.rating = 1.0;
				ratingObj.displayValue = " 0 / 0";
				ratingObj.detailedDisplayValue = gs.getMessage("Task has no skills"); 
				returnUsers[users[i]] = ratingObj;
			}
			return returnUsers;  
		}
		if(new CSMUtil().isDebugOn())
			gs.log(skillsRequired.join(),"this is skills");
		var skills = new GlideAggregate("sys_user_has_skill");
		skills.addEncodedQuery("skillIN" + skillsRequired.join());
		skills.addEncodedQuery("userIN"+ users.join());
		skills.addActiveQuery();
		skills.addAggregate("COUNT(DISTINCT", "skill");
		skills.addAggregate("MIN", "user.sys_id");
		skills.groupBy("user");
		skills.query();
		
		while(skills.next()){
			var skillCount = skills.getAggregate("COUNT(DISTINCT", "skill");
			var ratingObj = {};
			ratingObj.rating = Number(skillCount) * 1.0 / skillsRequired.length;
			ratingObj.value = skillCount;
			ratingObj.displayValue = skillCount + " / " + skillsRequired.length;
			ratingObj.detailedDisplayValue = this.getDetailedDisplayValue(skills.getAggregate("MIN", "user.sys_id"), skillsRequired); 
			returnUsers[skills.getAggregate("MIN","user.sys_id")] = ratingObj;
		}
		
		for(var i=0;i&lt; users.length;i++)
		{
			if(!returnUsers[users[i]]){
				var ratingObj = {};
				ratingObj.rating = 0;
				ratingObj.value = 0;
				ratingObj.displayValue = "0 / " + skillsRequired.length;
				ratingObj.detailedDisplayValue = gs.getMessage("No Matching Skills"); 
				returnUsers[users[i]] = ratingObj;
			}
		}

		return returnUsers;
	},
	
	getDetailedDisplayValue : function(user, skillsRequired){
		var skills = [];
		var skillGR = new GlideRecord("sys_user_has_skill");
		skillGR.addEncodedQuery("skillIN" + skillsRequired.join());
		skillGR.addEncodedQuery("userIN"+ user);
		skillGR.addActiveQuery();
		skillGR.query();
		while(skillGR.next())
			skills.push(skillGR.getDisplayValue('skill'));
		return skills.join(", ");
	},

    type: 'MatchingDimensionSkills'
});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2016-04-02 03:45:14&lt;/sys_created_on&gt;
        &lt;sys_id&gt;979c42d5c32212001c845cb981d3ae0d&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;85&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;MatchingDimensionSkills&lt;/sys_name&gt;
        &lt;sys_package display_value="Resource Matching Engine" source="com.snc.matching_rule"&gt;55d6f9412f140110d8a4d5f62799b646&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_979c42d5c32212001c845cb981d3ae0d&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2016-08-24 21:34:44&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;2732&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:29:59</sys_created_on>
        <sys_id>b02dcd7e2f331110d8a4d5f62799b6e9</sys_id>
        <sys_name>MatchingDimensionSkills</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_b02dcd7e2f331110d8a4d5f62799b6e9</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
