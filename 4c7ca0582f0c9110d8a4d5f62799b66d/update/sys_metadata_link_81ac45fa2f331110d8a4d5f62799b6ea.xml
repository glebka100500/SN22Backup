<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>5dae4c21373111003e7d40ed9dbe5d9e</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.sc_ScriptableOrderGuideFailure&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;Wrapper class for Scriptable Order Guide failures&lt;/description&gt;
        &lt;name&gt;sc_ScriptableOrderGuideFailure&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var sc_ScriptableOrderGuideFailure = Class.create();
sc_ScriptableOrderGuideFailure.prototype = Object.extendsObject(sc_Base, {
    MARKED_FOR_REPROCESSING: "Failure has been marked for processing",
    REPROCESS_EVENT: "reprocess",
    DELETE_EVENT: "delete",
    REPROCESSING: "reprocessing",

    /**
     * Sets the state of the failure to "reprocessing"
     */
    markForReprocessing: function() {
        this._log.debug("[markForReprocessing] Marking failure for reprocessing");

        this._gr.state = this.REPROCESSING;
        this._gr.update();
        
        return MARKED_FOR_REPROCESSING;
    },

    /**
     * Reprocess the order guide failure. If a workflow created the failure, run
     * it, otherwise execute the reprocessing directly.
     */
    reprocess: function() {
        if (this._gr.state.changesTo(this.REPROCESSING)) {
            this._log.debug("[reprocess] State didn't change to 'reprocessing', exiting");
            return;
        }

        if (this._hasWorkflow())
            this._runFlow(this.REPROCESS_EVENT);
        else {
            this._log.debug("[reprocess] No workflow associated, executing resprocess directly");

            var sog = new SNC.ScriptableOrderGuide(failure.order_guide);
            sog.reprocess(this._gr);

            return sog;
        }
    },

    /**
     * Calls the delete event if the failure was created by a workflow
     */
    deleted: function() {
        if (this._hasWorkflow())
            this._runFlow(this.DELETE_EVENT);
    },

    _runFlow: function(eventName) {
        this._log.debug("[_runFlow] Kicking off workflow event -- " + eventName);

        var sourceTable = this._gr.source_table;
        var sourceId = this._gr.source_document;

        var sourceGR = new GlideRecord(sourceTable);
        if (sourceGR.get(sourceId))
            new Workflow().runFlows(sourceGR, eventName);
    },

    _hasWorkflow: function() {
        if (!this._gr.source_table &amp;&amp; !this._gr.source_document &amp;&amp; !this._gr.wf_activity)
            return false;

        return true;
    },

    type: 'sc_ScriptableOrderGuideFailure'
});]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2013-12-21 21:45:39&lt;/sys_created_on&gt;
        &lt;sys_id&gt;5dae4c21373111003e7d40ed9dbe5d9e&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;33&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;sc_ScriptableOrderGuideFailure&lt;/sys_name&gt;
        &lt;sys_package display_value="Service Catalog Platform" source="com.glideapp.servicecatalog.platform"&gt;6d218d0f6d2620100acb70b35343303c&lt;/sys_package&gt;
        &lt;sys_policy&gt;read&lt;/sys_policy&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_5dae4c21373111003e7d40ed9dbe5d9e&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2013-12-28 21:20:18&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;2124&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:27:49</sys_created_on>
        <sys_id>81ac45fa2f331110d8a4d5f62799b6ea</sys_id>
        <sys_name>sc_ScriptableOrderGuideFailure</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_81ac45fa2f331110d8a4d5f62799b6ea</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
