<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>46af30655b330010da168d8fa881c717</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;public&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.OauthTokenChecker&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;If "glide.sg.device_encryption_enabled" system property is being updated to "false", need to check for the OAuth refresh token lifespan of all mobile native clients and ensure that their values are not greater than 100 days.&lt;/description&gt;
        &lt;name&gt;OauthTokenChecker&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var OauthTokenChecker = Class.create();

OauthTokenChecker.prototype = {
	initialize: function() {},

	checkRefreshTokenLifespan: function(current, previous) {
		var gr = new GlideRecord("oauth_entity");
		gr.addEncodedQuery("client_id=ff97fbb4da3313004591cc3a291b47fd^ORclient_id=5c54dc934a022300cb7946e6ec6ec172^ORclient_id=8497bdfb7a5573002f07962dec25c863^ORclient_id=0bf98863a813001046cfa356db171c54");
		gr.query();
		while(gr.next()) {
			if(gr.getValue("refresh_token_lifespan") &gt; 8640000) {
				gs.log('For security reason, device encryption feature should not be turned off when oauth token lifespan is longer than 100 days. Check oauth_entity table and make sure all native mobile clients have refresh token lifespan set to not larger than 8,640,000, and then proceed the action');
				gs.addErrorMessage(gs.getMessage("To set this property to false, you need to decrease the refresh token lifespan of all mobile clients to less than [8,640,000]. You can do this &lt;a href = '/nav_to.do?uri=%2Foauth_entity_list.do%3Fsysparm_query%3Dtype%3Dclient%5EORtype%3Doauth_provider%5Eclient_idINff97fbb4da3313004591cc3a291b47fd,5c54dc934a022300cb7946e6ec6ec172,8497bdfb7a5573002f07962dec25c863,0bf98863a813001046cfa356db171c54%26sysparm_first_row%3D1%26sysparm_view%3D' target='_blank'&gt;here&lt;/a&gt;."));
				current.setAbortAction(true);
				return;
			}
		}
	}
};
]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2020-03-26 17:51:51&lt;/sys_created_on&gt;
        &lt;sys_id&gt;46af30655b330010da168d8fa881c717&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;1&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;OauthTokenChecker&lt;/sys_name&gt;
        &lt;sys_package display_value="Mobile plugin" source="com.glide.sg"&gt;0ced34cb6d2220100acb70b3534330d3&lt;/sys_package&gt;
        &lt;sys_policy&gt;read&lt;/sys_policy&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_46af30655b330010da168d8fa881c717&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2020-03-26 17:57:39&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;1360&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:27:13</sys_created_on>
        <sys_id>c48c0dba2f331110d8a4d5f62799b642</sys_id>
        <sys_name>OauthTokenChecker</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_c48c0dba2f331110d8a4d5f62799b642</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
