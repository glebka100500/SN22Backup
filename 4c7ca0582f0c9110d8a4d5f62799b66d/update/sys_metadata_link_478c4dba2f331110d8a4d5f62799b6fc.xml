<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>update</directory>
        <documentkey>4ed2e4ce0a0a0b340095fed20f2e2853</documentkey>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_script_include"&gt;
    &lt;sys_script_include action="INSERT_OR_UPDATE"&gt;
        &lt;access&gt;package_private&lt;/access&gt;
        &lt;active&gt;true&lt;/active&gt;
        &lt;api_name&gt;global.ConnectionURL&lt;/api_name&gt;
        &lt;caller_access/&gt;
        &lt;client_callable&gt;false&lt;/client_callable&gt;
        &lt;description&gt;Given a sys_data_source glide record, construct a&amp;#13;
			connection URL&lt;/description&gt;
        &lt;name&gt;ConnectionURL&lt;/name&gt;
        &lt;script&gt;&lt;![CDATA[var ConnectionURL = Class.create();

ConnectionURL.prototype = {
	initialize : function(gr) {
		this.sysDataSourceGR = gr;
		this.type = gr.type;
		this.connection_url;
	},
	
	getFileConnectionURL : function () {
		if (this.sysDataSourceGR.file_retrieval_method == "File") {
			// file paths must be absolute
			this.connection_url = "file://" + this.sysDataSourceGR.file_path;
			return this.connection_url;
		}
		
		if (this.sysDataSourceGR.file_retrieval_method == "HTTP" || this.sysDataSourceGR.file_retrieval_method == "HTTPS")
			return this.getHTTPConnectionURL();
		
		if (this.sysDataSourceGR.file_retrieval_method == "SCP")
			return this.getSCPConnectionURL();
		
		if (this.sysDataSourceGR.file_retrieval_method == "Attachment") {
			this.connection_url = "attachment://sys_data_source:" +
			this.sysDataSourceGR.sys_id + "/" + this.sysDataSourceGR.file_path;
			
			if (!this.sysDataSourceGR.ssh_keyfile_path.nil())
				this.connection_url += "#" + this.sysDataSourceGR.ssh_keyfile_path;
			
			return this.connection_url;
		}
		
		if (this.sysDataSourceGR.file_retrieval_method.toString().indexOf("FTP") &gt;= 0)
			return this.getFTPConnectionURL();
		
		return this.connection_url;
	},
	
	getFTPConnectionURL : function () {
		var frm = this.sysDataSourceGR.file_retrieval_method;
		if(frm == "FTP")
			this.connection_url = "ftp://";
		else if(frm == "SFTP")
			this.connection_url = "sftp://";
		else if(frm == "FTPS (Implicit SSL)")
			this.connection_url = "ftpssl://";
		else if(frm == "FTPS (Implicit TLS)")
			this.connection_url = "ftptls://";
		else if(frm == "FTPS (Auth SSL)")
			this.connection_url = "ftpauthssl://";
		else if(frm == "FTPS (Auth TLS)")
			this.connection_url = "ftpauthtls://";
		
		this.buildAuthPartOfUrl();
		this.appendServer(this.sysDataSourceGR.scp_server);
		
		if (frm == "SFTP")
			this.appendPort(this.sysDataSourceGR.scp_port);
		
		if (this.sysDataSourceGR.file_path.startsWith("/"))
			this.connection_url += "/%2F" + this.sysDataSourceGR.file_path.substring(1);
		else
			this.connection_url += "/" + this.sysDataSourceGR.file_path;
		
		return this.connection_url;
	},
	
	getSCPConnectionURL : function () {
		this.connection_url = "scp://";
		
		if (!this.sysDataSourceGR.scp_user_name.nil())
			this.buildAuthPartOfUrl();
		
		this.appendServer(this.sysDataSourceGR.scp_server);
		this.appendFilePath(this.sysDataSourceGR.file_path);
		
		if (!this.sysDataSourceGR.ssh_keyfile_path.nil())
			this.connection_url += "#" + this.sysDataSourceGR.ssh_keyfile_path;
		
		return this.connection_url;
	},
	
	getHTTPConnectionURL : function () {
		if (this.sysDataSourceGR.file_retrieval_method == "HTTP")
			this.connection_url = "http://";
		
		if (this.sysDataSourceGR.file_retrieval_method == "HTTPS")
			this.connection_url = "https://";
		
		var encoded_file_path = this.getEncodedFilePath(this.sysDataSourceGR.file_path);
		
		if (!this.sysDataSourceGR.scp_user_name.nil())
			this.buildAuthPartOfUrl();
		
		this.appendServer(this.sysDataSourceGR.scp_server);
		this.appendPort(this.sysDataSourceGR.scp_port);
		this.appendFilePath(encoded_file_path);
		
		return this.connection_url;
	},
	
	getJDBCConnectionURL : function () {
		var SQLServer = "com.microsoft.sqlserver.jdbc.SQLServerDriver";
		var MySQL = "org.mariadb.jdbc.Driver";
		var oldMySQL = "com.mysql.jdbc.Driver";
		var Oracle = "oracle.jdbc.OracleDriver";
		var DB2 = "com.ibm.db2.jcc.DB2Driver";
		var Sybase = "com.sybase.jdbc3.jdbc.SybDriver";
		
		var format = this.sysDataSourceGR.format;
		var instanceName = this.sysDataSourceGR.instance_name;
		var databaseName = this.sysDataSourceGR.database_name;
		var server = this.sysDataSourceGR.jdbc_server;
		var port = this.sysDataSourceGR.database_port;
		var connection_url_parameters =  this.sysDataSourceGR.connection_url_parameters;
		
		if (format == MySQL || format == oldMySQL || format == SQLServer) {
			if (!this.sysDataSourceGR.database_port.nil())
				port = ":" + port;
			else
				port = "";
			
			var driver = "jdbc:mysql://";
			if (format == SQLServer)
				driver = "jdbc:sqlserver://";
			
			this.connection_url = driver + server + port;
			
			if (format == SQLServer) {
				if (JSUtil.notNil(instanceName))
					this.connection_url += ";instanceName=" + instanceName;
				
				this.connection_url += ";selectMethod=cursor;databaseName=" + databaseName;
				
				if (this.sysDataSourceGR.use_integrated_authentication == true)
					this.connection_url += ";integratedSecurity=true";
				
			} else {
				this.connection_url += "/" + databaseName;
			}
		}
		
		if (format == Sybase) {
			this.connection_url = "jdbc:sybase:Tds:" + server + ":" +
			port + "/" + databaseName;
		}
		
		if (format == Oracle) {
			this.connection_url = "jdbc:oracle:thin:@" + server + ":" +
			this.sysDataSourceGR.oracle_port + ":" + this.sysDataSourceGR.oracle_sid;
		}
		
		if (format == DB2) {
			this.connection_url = "jdbc:db2://" + server + ":" +
			port + "/" + databaseName;
		}
		
		if (JSUtil.notNil(connection_url_parameters)) {
			this.connection_url += ";" + connection_url_parameters;
		}
		return this.connection_url;
	},
	
	getConnectionURL : function () {
		if (this.sysDataSourceGR.type == "File")
			return this.getFileConnectionURL();
		
		if (this.sysDataSourceGR.type == "JDBC")
			return this.getJDBCConnectionURL();
		
		return this.connection_url;
	},
	
	getEncodedFilePath : function(file_path) {
		var encoded_file_path = encodeURI(file_path);
		return encoded_file_path;
	},
	
	buildAuthPartOfUrl : function () {
		var passwd = "${scp_password}";
		this.connection_url += this.sysDataSourceGR.scp_user_name + ":" +passwd + '@';
	},
	
	appendServer : function (server_name) {
		if (JSUtil.notNil(server_name))
			this.connection_url += server_name;
	},
	
	appendPort : function (server_port) {
		if (JSUtil.notNil(server_port))
			this.connection_url += ':' + server_port;
	},
	
	appendFilePath : function (file_path) {
		if (JSUtil.notNil(file_path)) {
			if (file_path.startsWith("/"))
				this.connection_url += file_path;
			else 
				this.connection_url += "/" + file_path;
		}
	},
	
	getPassword : function (encrypted) {
		var Encrypter = new GlideEncrypter();
		return Encrypter.decrypt(encrypted);
	},
}]]&gt;&lt;/script&gt;
        &lt;sys_class_name&gt;sys_script_include&lt;/sys_class_name&gt;
        &lt;sys_created_by&gt;glide.maint&lt;/sys_created_by&gt;
        &lt;sys_created_on&gt;2009-08-24 23:53:02&lt;/sys_created_on&gt;
        &lt;sys_id&gt;4ed2e4ce0a0a0b340095fed20f2e2853&lt;/sys_id&gt;
        &lt;sys_mod_count&gt;13&lt;/sys_mod_count&gt;
        &lt;sys_name&gt;ConnectionURL&lt;/sys_name&gt;
        &lt;sys_package display_value="System Import Data Source" source="com.glide.system_import_data_source"&gt;205d38876d2220100acb70b353433035&lt;/sys_package&gt;
        &lt;sys_policy/&gt;
        &lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;
        &lt;sys_update_name&gt;sys_script_include_4ed2e4ce0a0a0b340095fed20f2e2853&lt;/sys_update_name&gt;
        &lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;
        &lt;sys_updated_on&gt;2015-09-18 23:51:24&lt;/sys_updated_on&gt;
        &lt;u_script_length&gt;6218&lt;/u_script_length&gt;
    &lt;/sys_script_include&gt;
&lt;/record_update&gt;
</payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-19 20:27:25</sys_created_on>
        <sys_id>478c4dba2f331110d8a4d5f62799b6fc</sys_id>
        <sys_name>ConnectionURL</sys_name>
        <sys_package display_value="Integrations 2022" source="x_644088_integrati">4c7ca0582f0c9110d8a4d5f62799b66d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Integrations 2022">4c7ca0582f0c9110d8a4d5f62799b66d</sys_scope>
        <sys_update_name>sys_metadata_link_478c4dba2f331110d8a4d5f62799b6fc</sys_update_name>
        <tablename>sys_script_include</tablename>
    </sys_metadata_link>
</record_update>
